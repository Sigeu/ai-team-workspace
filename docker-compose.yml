services:
  cli-proxy-api:
    image: eceasy/cli-proxy-api:latest
    pull_policy: always
    container_name: cli-proxy-api
    ports:
      - "8317:8317"
      - "8085:8085"
      - "1455:1455"
      - "54545:54545"
      - "51121:51121"
      - "11451:11451"
    volumes:
      - ./proxy/config.yaml:/CLIProxyAPI/config.yaml
      - ./proxy/auths:/root/.cli-proxy-api
      - ./proxy/logs:/CLIProxyAPI/logs
    restart: unless-stopped

  web-console:
    build:
      context: ./web-console
    container_name: web-console
    user: "1000:1000"
    ports:
      - "38317:38317"
    volumes:
      - ./workspaces:/workspaces # Mount shared workspace to read tasks and files
    restart: unless-stopped

  claude-bot:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile.base
    container_name: claude-bot
    user: "1000:1000"
    stdin_open: true
    tty: true
    volumes:
      - ./workspaces:/workspaces
      - ./config/claude:/home/node/.claude
      - ./config/npm-global:/home/node/.npm-global
      - ./install-agents.sh:/usr/local/bin/install-agents.sh
    environment:
      - ROLE=CLAUDE
      - ANTHROPIC_BASE_URL=${PROXY_API_URL:-}
      - ANTHROPIC_AUTH_TOKEN=${PROXY_API_KEY:-}
      - ANTHROPIC_DEFAULT_OPUS_MODEL=${PROXY_CLAUDE_OPUS_MODEL:-}
      - ANTHROPIC_DEFAULT_SONNET_MODEL=${PROXY_CLAUDE_SONNET_MODEL:-}
      - ANTHROPIC_DEFAULT_HAIKU_MODEL=${PROXY_CLAUDE_HAIKU_MODEL:-}
    command: /usr/local/bin/install-agents.sh

  gemini-bot:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile.base
    container_name: gemini-bot
    user: "1000:1000"
    stdin_open: true
    tty: true
    volumes:
      - ./workspaces:/workspaces
      - ./config/gemini:/home/node/.gemini
      - ./config/npm-global:/home/node/.npm-global
      - ./install-agents.sh:/usr/local/bin/install-agents.sh
    environment:
      - ROLE=GEMINI
      - GOOGLE_GEMINI_BASE_URL=${PROXY_API_URL:-}
      - GEMINI_API_KEY=${PROXY_API_KEY:-}
    command: /usr/local/bin/install-agents.sh
